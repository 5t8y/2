
<!doctype html>
<html lang="en">
<head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-57FR6ZG');</script>
<!-- End Google Tag Manager -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0, shrink-to-fit=no" />
<meta name="keywords" content="Thanks for Downloading Filmora" />
<meta name="description" content="Thanks for Downloading Filmora. The Filmora installer will start downloading automatically." />
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
<title>Thanks for Downloading Filmora</title>

<link rel="shortcut icon" href="https://filmora.wondershare.com/favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="https://neveragain.allstatics.com/2019/assets/style/bootstrap-wondershare.min.css" />
<link rel="stylesheet" href="https://neveragain.allstatics.com/2019/assets/style/font-custom-hm.min.css">
<style>
  main.wsc-main, h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {font-family: 'HarmonyOS Sans', -apple-system, blinkmacsystemfont, 'Segoe UI', roboto, 'Helvetica Neue', arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'!important;}
</style>


<style>
     .ws-nps-form-type2{
        display: none !important;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
     
      main.wsc-main {
        color: #000;
        min-height: 100vh;
      }
      main.wsc-main h1,
      main.wsc-main h2,
      main.wsc-main h3,
      main.wsc-main h4,
      main.wsc-main h5,
      main.wsc-main h6,
      main.wsc-main p,
      main.wsc-main div,
      main.wsc-main span {
        margin-bottom: 0;
      }
      main.wsc-main .text-gray {
        color: #444;
      }
      main.wsc-main .opacity-6 {
        opacity: 0.6;
      }
      main.wsc-main .text-underline {
        text-decoration: underline;
      }
      main.wsc-main .main-section {
        background-image: linear-gradient(0deg, rgb(255, 255, 255) 0%, rgb(255, 255, 255) 67.21%, rgba(255, 255, 255, 0) 100%),
          linear-gradient(-103.35deg, rgb(215, 252, 254) 3.73%, rgb(251, 213, 250) 56.7%, rgb(254, 224, 213) 100.35%);
        background-repeat: no-repeat;
        border-radius: 1.5rem;
      }
      main.wsc-main .main-section .resDownBtn {
        max-height: 4rem;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
      }
      main.wsc-main .main-section .step-wrapper {
        max-width: 1260px;
        margin: 0 auto;
      }
      main.wsc-main .main-section .step-item {
        border-radius: 0.625rem;
        border: 1px solid #e6e6e6;
        overflow: hidden;
        background-color: #fff;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      main.wsc-main .main-section .step-item .step-content {
        padding: 1.5rem 1.5rem 1.375rem;
        letter-spacing: -0.03em;
      }
      main.wsc-main .main-section .step-item .step-video {
        line-height: 0;
        font-size: 0;
      }
      main.wsc-main .main-section .step-item .step-video video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: grayscale(0);
        clip-path: fill-box;
      }
      .download-guidance-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 100;
      }
      .download-guidance-box {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #fff;
        border-radius: 0.75rem;
        padding: 2rem;
        padding-left: 3.375rem;
        cursor: default;
        animation: breathing-scale 3s ease-in-out infinite;
        max-width: 440px;
      }
      @keyframes breathing-scale {
        0%,
        100% {
          transform: scale(0.98);
        }
        50% {
          transform: scale(1.02);
        }
      }
      .download-guidance-overlay.hidden {
        display: none;
      }
      .download-guidance-content {
        display: flex;
        flex-direction: column;
        position: relative;
      }
      .download-step{
        position: relative;
        padding-bottom: 0.75rem;
      }
      .download-step::before {
        position: absolute;
        top: 10px;
        left: -18px;
        width: 6px;
        height: 6px;
        background: #006DFF;
        border-radius: 50%;
        content: '';
      }

      /* Dashed line connecting steps */
      .download-step:not(:last-child)::after {
        position: absolute;
        left: -16px;
        top: 20px;
        width: 1px;
        height: calc(100% - 10px);
        border-left: 1px dashed rgba(0, 109, 255, 0.6);
        content: '';
      }
      .download-step:nth-child(1){
        padding-bottom: 0.75rem;
      }
      .download-step:nth-child(1)::after{
        position: absolute;
        height: 100%;
        width: 1px;
        border-left:1px dashed rgba(0, 109, 255, 0.6);
        content: '';
        left: -16px;
        top: 12px;
      }
      .download-step::before{
        position: absolute;
        top: 10px;
        left:-18px;
        width: 6px;
        height: 6px;
        background: #006DFF;
        border-radius: 50%;
        content: '';
      }
      #tutorial-video-modal .modal-dialog {
        min-width: 850px;
        min-height: 100vh;
      }
      #tutorial-video-modal .modal-content {
        box-shadow: none;
        padding: 1.5rem;
        border-radius: 0.75rem;
        overflow: hidden;
        background-color: #fff;
      }
      #tutorial-video-modal .modal-content .modal-header {
        all: unset;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      #tutorial-video-modal .modal-content .modal-video {
        border-radius: 8px;
        overflow: hidden;
      }
      .sign-up-btn {
    color: #000;
    background-color: #50e3c2;
    border-color: #50e3c2;
    -webkit-box-shadow: none;
    box-shadow: none
}

.sign-up-btn:hover {
    color: #000;
    background-color: #2fdeb7;
    border-color: #24dcb3
}

.sign-up-btn:focus,.sign-up-btn.focus {
    color: #000;
    background-color: #2fdeb7;
    border-color: #24dcb3;
    -webkit-box-shadow: 0 0 0 .2rem rgba(68,193,165,0.5);
    box-shadow: 0 0 0 .2rem rgba(68,193,165,0.5)
}

.sign-up-btn.disabled,.sign-up-btn:disabled {
    color: #000;
    background-color: #50e3c2;
    border-color: #50e3c2
}

.sign-up-btn:not(:disabled):not(.disabled):active,.sign-up-btn:not(:disabled):not(.disabled).active,.show>.sign-up-btn.dropdown-toggle {
    color: #000;
    background-color: #24dcb3;
    border-color: #22d2aa
}

.sign-up-btn:not(:disabled):not(.disabled):active:focus,.sign-up-btn:not(:disabled):not(.disabled).active:focus,.show>.sign-up-btn.dropdown-toggle:focus {
    -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,0.125),0 0 0 .2rem rgba(68,193,165,0.5);
    box-shadow: inset 0 3px 5px rgba(0,0,0,0.125),0 0 0 .2rem rgba(68,193,165,0.5)
}
#browser-shortcut{font-weight: 700;}
    </style>


<script type="text/javascript">
            var CHANNEL_ID = "45";
            var SITE_ID = "45";
            var CMS_LANGUAGE = "en";
            var TEMPLATE_ID = "10007782";
            var PAGE_ID = "561006";
            var TEMPLATE_MODULE = "other";
            var TEMPLATE_TYPE = "index";
</script></head>
<body data-pro="filmora" data-cat="general" data-nav="downloadGuidance" data-sys="auto" data-dev="auto" data-lan="en">



<main class="wsc-main p-lg-3 p-xxl-5 overflow-auto position-relative">
  <section class="main-section px-3 py-4 px-xxl-5">
    <div class="container-fluid">
      <div class="text-center">
        <div class="text-left pb-xxl-2 mb-xl-n4 mb-xxl-1">
          <img
            
            src="https://neveragain.allstatics.com/2019/assets/icon/logo/wondershare-vertical.svg"
            alt="Wondershare"
            class="img-fluid"
            style="height: 4rem" />
        </div>
        <div class="d-xl-flex align-items-center justify-content-center">
          <div class="flex-shrink-0">
            <img
              
              src="https://neveragain.allstatics.com/2019/assets/icon/logo/filmora-square.svg"
              alt="Wondershare Filmora"
              class="img-fluid"
              style="height: 3rem" />
          </div>
          <h1 class="h2 my-xl-0 my-2 mx-xl-4">Download not working?</h1>
          <a href="#" class="d-none btn-link"></a>
          <a
            href="#"
            class="btn-lg btn btn-action btn-uncap rounded-pill resDownBtn"
            >Restart download</a
          >
        </div>
      </div>
      <div class="text-center pt-xxl-3 mt-4">
      <div class="text-gray">After installing <strong id="productName">Wondershare Filmora</strong>, head to the Refer a Friend to start earning. <br>Invite friends, collect points, and claim exclusive rewards like
        <span class="mx-1 rounded-pill font-size-small" style="background: linear-gradient(180deg, rgba(29, 255, 217, 0.5) 0%, rgba(176, 255, 202, 0.5) 100%);color: #000;padding: 3px 8px;white-space: nowrap;">30-Day Free License</span>
        <span class="rounded-pill font-size-small" style="background: linear-gradient(180deg, rgba(29, 255, 217, 0.5) 0%, rgba(176, 255, 202, 0.5) 100%);color: #000;padding: 3px 8px;white-space: nowrap;">1000 AI Credits</span>
        <span class="mx-1 rounded-pill font-size-small" style="background: linear-gradient(180deg, rgba(29, 255, 217, 0.5) 0%, rgba(176, 255, 202, 0.5) 100%);color: #000;padding: 3px 8px;white-space: nowrap;">Veo 3 Free Trial</span>
        <a href="https://filmora.wondershare.com/referral-program.html" target="_blank" class="font-size-small text-action text-underline">View Program Details >> </a>
        </div>
    </div>
      <!-- 步骤引导区域，包含三步操作说明及对应视频演示 -->
      <div class="step-wrapper">
        <div class="row row-cols-1 row-cols-lg-3 justify-content-center pb-2">
          <!-- 第一步：Open -->
          <div class="col py-3 h-auto">
            <div class="step-item">
              <div class="step-content">
                <div class="d-flex align-items-center font-weight-bold mb-1">
                  <span class="font-size-large mr-2">1</span>
                  <div class="font-size-huge">Open</div>
                </div>
                <p class="font-size-small text-gray pt-2">
                  Click the browser's upper-right icon or press <span id="browser-shortcut">Ctrl + J</span> to find and launch the downloaded file.
                </p>
              </div>
              <!-- win第一步视频 -->
              <div class="step-video sys-win">
                <video
                  data-src="https://filmora.wondershare.com/videos/download/fx_step_1_open_win.mp4"
                  poster="https://images.wondershare.com/filmora/download-guide/fx_step_1_open_win.png"
                  loop
                  muted
                  playsinline></video>
              </div>
              <!-- mac第一步视频 -->
              <div class="step-video sys-mac">
                <video
                  data-src="https://filmora.wondershare.com/videos/download/fx_step_1_open_mac.mp4"
                  poster="https://images.wondershare.com/filmora/download-guide/fx_step_1_open_mac.png"
                  loop
                  muted
                  playsinline></video>
              </div>
            </div>
          </div>
          <!-- 第二步：Allow -->
          <div class="col py-3 h-auto sys-mac">
            <div class="step-item">
              <div class="step-content">
                <div class="d-flex align-items-center font-weight-bold mb-1">
                  <span class="font-size-large mr-2">2</span>
                  <div class="font-size-huge">Allow</div>
                </div>
                <p class="font-size-small text-gray pt-2">If the consent prompt appears, please allow the installation.</p>
              </div>
              <div class="step-video">
                <video
                  data-src="https://filmora.wondershare.com/videos/download/fx_step_2_allow_en.mp4"
                  poster="https://images.wondershare.com/filmora/download-guide/fx_step_2_allow_en.png"
                  loop
                  muted
                  playsinline></video>
              </div>
            </div>
          </div>
          <!-- 第三步：Install -->
          <div class="col py-3 h-auto">
            <div class="step-item">
              <div class="step-content">
                <div class="d-flex align-items-center font-weight-bold mb-1">
                  <span class="font-size-large mr-2 sys-win">2</span>
                  <span class="font-size-large mr-2 sys-mac">3</span>
                  <div class="font-size-huge">Install</div>
                </div>
                <p class="font-size-small text-gray pt-2">Follow the instructions and wait for the installation to complete.</p>
              </div>
              <div class="step-video">
                <video
                  data-src="https://filmora.wondershare.com/videos/download/fx_step_3_install.mp4"
                  poster="https://images.wondershare.com/filmora/download-guide/fx_step_3_install.png"
                  loop
                  muted
                  playsinline></video>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="font-size-small text-gray text-center pb-2">
        Need more help?<a href="#" class="text-underline text-action ml-2" data-toggle="modal" data-target="#tutorial-video-modal"
          >Watch tutorial video</a
        >
      </div>
      <!--2023 V13 New Version-->
    <div class="text-center">
        <div class="d-inline-flex flex-md-row flex-column align-items-md-center justify-content-center text-left">
            <div class="d-flex align-items-center px-xl-4 mx-md-3 py-md-3 py-2">
                <div class="pr-3"><img src="https://images.wondershare.com/filmora/images2025/g2-crowd-pic.png" style="width: 4.5rem;" alt="g2 crowd"></div>
                <div>
                    <h3 class="letter-spacing-2 h5">G2 Crowd </h3>
                    <div class="text-color2 font-size-normal">2025 Fall Leader</div>
                </div>
            </div>
            <div class="d-flex align-items-center px-xl-4 mx-md-3 py-md-3 py-2">
                <div class="pr-3"><img src="https://images.wondershare.com/filmora/images2023/video-solution/youtube/shorty-award-pic.png" style="width: 4.5rem;" alt="shorty award"></div>
                <div>
                    <h3 class="letter-spacing-2 h5">Shorty Awards</h3>
                    <div class="text-color2 font-size-normal">Best in Photo and Video</div>
                </div>
            </div>
            <div class="d-flex align-items-center px-xl-4 mx-md-3 py-md-3 py-2">
                <div class="pr-3"><img src="https://images.wondershare.com/filmora/filmora13/homepage/getapp-pic.png" style="width: 4.5rem;" alt="getapp"></div>
                <div>
                    <h3 class="letter-spacing-2 h5">GetApp</h3>
                    <div class="text-color2 font-size-normal">Video Editing Leaders</div>
                </div>
            </div>
        </div>
    </div>
      <div class="pt-4 text-gray text-center">
        By downloading. you agree to the Privacy Policy and EULA.
      </div>
    </div>
    <a data-href="https://accounts.wondershare.com" data-source="3" class="wsc-header2020-navbar-linkBtn login-link d-none" style="background-color: #006dff;color: #fff;font-weight: 600;border-radius: 4px;">Sign in</a>
 
  </section>
</main>
<!-- 下载指引弹窗 -->
<aside class="download-guidance-overlay hidden" id="download-guidance-overlay">
  <div class="download-guidance-box">
    <div class="download-guidance-content">
      <div class="download-step">
        <strong>step1: </strong>Click the icon to open the download list
        <img
        src="https://images.wondershare.com/drfone/images2025/download-guidance-mac/step1-img.png"
        alt="step1"
        class="img-fluid"
        style="height: 4rem;margin-top: 0.75rem;" />
      </div>
      <div class="download-step">
        <strong>step2: </strong>Click the downloaded file to install
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-win.png"
        alt="step2"
        class="img-fluid sys-win"
        style="height: 4rem;margin-top: 0.75rem;" />
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-mac.png"
        alt="step2"
        class="img-fluid sys-mac"
        style="height: 4rem;margin-top: 0.75rem;" />
      </div>
      <div class="download-step">
        <strong>step2: </strong>Click the downloaded file to install
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-win.png"
        alt="step2"
        class="img-fluid sys-win"
        style="height: 4rem;margin-top: 0.75rem;" />
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-mac.png"
        alt="step2"
        class="img-fluid sys-mac"
        style="height: 4rem;margin-top: 0.75rem;" />
      </div>
      <div class="download-step">
        <strong>step2: </strong>Click the downloaded file to install
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-win.png"
        alt="step2"
        class="img-fluid sys-win"
        style="height: 4rem;margin-top: 0.75rem;" />
        <img
        src="https://images.wondershare.com/filmora/download-guide/filmora-step2-mac.png"
        alt="step2"
        class="img-fluid sys-mac"
        style="height: 4rem;margin-top: 0.75rem;" />
      </div>
    </div>
  </div>
</aside>
<!-- 教程视频弹窗 -->
<aside class="modal fade" id="tutorial-video-modal" tabindex="-1" role="dialog" aria-labelledby="tutorial-video-modal-label" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="font-weight-bold mb-0">Tutorial Video</h5>
        <span data-dismiss="modal" aria-label="close" class="with-hand">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4.46582 3.90698L20.3728 19.814" stroke="#B2B2B2" stroke-width="1.2" stroke-linecap="round" />
            <path d="M20.3711 3.90698L4.46412 19.814" stroke="#B2B2B2" stroke-width="1.2" stroke-linecap="round" />
          </svg>
        </span>
      </div>
      <div class="modal-body text-center p-0">
        <!-- 可替换为实际教程视频链接 -->
        <div class="wsc-youtube-player active bg-black embed-responsive embed-responsive-16by9 my-3 modal-video">
          <iframe
            id="tutorial-video-iframe"
            class="w-100"
            data-mac-src="https://www.youtube.com/embed/6l4srCzRnO0?enablejsapi=1&autoplay=0"
            data-win-src="https://www.youtube.com/embed/zGJEFG3l0jU?enablejsapi=1&autoplay=0"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
        </div>
        <p class="text-gray text-left mb-0">
          For more information, you can
          <a
            href="https://support.wondershare.com/how-tos/wondershare/?cat_id=10007960&page_url=/how-tos/wondershare/how-do-i-install-the-software.html"
            target="_blank"
            class="text-action"
            >click here</a
          >
          to check out FAQs
        </p>
      </div>
    </div>
  </div>
</aside>


<script src="https://neveragain.allstatics.com/2019/assets/vendor/wsc-vendor.js"></script>
<script src="https://neveragain.allstatics.com/2019/assets/script/wsc-common.js"></script>
<script>$(function () { wsc.common.init() })</script>


<script>
     $(() => {
      // 通用常量
      const PAGE_LOAD_TIME = Date.now();
      
      function handleQuery(query) {
        var reg = new RegExp('(^|&)' + query + '=([^&]*)(&|$)', 'i')
        var r = window.location.search.substr(1).match(reg)
        if (r != null) return decodeURIComponent(r[2])
        return null
    }
   var platform = navigator.userAgent.match(/Mac/i) ? "mac" : navigator.userAgent.match(/Windows/i) ? "win" : "win";
   var defaultUrl = platform === 'mac' ? 'link tai' : 'link tai';
   var downloadUrl = handleQuery('download_url') ? handleQuery('download_url').split('?')[0] : defaultUrl
   $('.resDownBtn,.btn-link').attr('href', downloadUrl)

  // ========== 埋点管理功能 ==========
  function initAnalytics() {
    const Analytics = {
      commonParams: {},

      updateConfig(key, value) {
        if (this.commonParams.hasOwnProperty(key)) {
          this.commonParams[key] = value;
        } else {
          console.warn(`Analytics: 未知的配置项 ${key}`);
        }
      },

      getOSVersion() {
        const userAgent = navigator.userAgent;
        if (/Windows NT 10.0/i.test(userAgent)) return "Windows 10";
        if (/Windows NT 6.3/i.test(userAgent)) return "Windows 8.1";
        if (/Windows NT 6.2/i.test(userAgent)) return "Windows 8";
        if (/Windows NT 6.1/i.test(userAgent)) return "Windows 7";
        if (/Mac OS X 10[._](\d+)/i.test(userAgent)) {
          const version = userAgent.match(/Mac OS X 10[._](\d+)/i);
          return `macOS 10.${version[1]}`;
        }
        if (/Mac OS X/i.test(userAgent)) return "macOS";
        if (/Linux/i.test(userAgent)) return "Linux";
        return "Unknown";
      },
      getBrowserInfo() {
        const userAgent = navigator.userAgent;
        if (/Edg/i.test(userAgent)) return "Microsoft Edge";
        if (/Chrome/i.test(userAgent) && !/Edg/i.test(userAgent)) return "Google Chrome";
        if (/Firefox/i.test(userAgent)) return "Mozilla Firefox";
        if (/Safari/i.test(userAgent) && !/Chrome/i.test(userAgent)) return "Safari";
        if (/Opera|OPR/i.test(userAgent)) return "Opera";
        return "Unknown Browser";
      },

      extractPidFromUrl(downloadUrl) {
        const pidMatch = downloadUrl.match(/full(\d+)\./);
        return pidMatch ? parseInt(pidMatch[1]) : 0;
      },

      initCommonParams() {
        const defaultDownloadUrl = downloadUrl;

        this.commonParams = {
          trace_id: "",
          ip: "",
          pid: parseInt(this.extractPidFromUrl(defaultDownloadUrl)) || 0,
          oszone: Intl.DateTimeFormat().resolvedOptions().timeZone || "Asia/Shanghai",
          osbit: navigator.platform.includes("64") ? "64" : "32",
          os_version: this.getOSVersion(),
          ostype: /Windows/i.test(navigator.userAgent) ? "Windows" : /Macintosh/i.test(navigator.userAgent) ? "Mac" : "Other",
          oslang: navigator.language || "zh-CN",
          ext_fields: JSON.stringify({
            user_browser: this.getBrowserInfo(),
            referer_url: window.location.href,
            back_url: defaultDownloadUrl,
          }),
        };
      },

      getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
        return null;
      },

      getDownloadId() {
        const pid = this.commonParams.pid;
        const cookieName = `download_id_${pid}`;
        const cookieValue = this.getCookie(cookieName) || "";
        if (!cookieValue) {
          return "";
        }
        const match = cookieValue.match(/^[^_]*_[^_]*_(.*)$/);
        return match ? match[1] : cookieValue;
      },

      track(eventName, eventData = {}) {
        const eventInfo = {
          ...this.commonParams,
          event: eventName,
          download_id: this.getDownloadId(),
          ...eventData,
        };

        fetch("https://prod-web.wondershare.cc/api/v1/prodweb/wae/report_data", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify(eventInfo),
        })
          .then((response) => {
            if (!response.ok) {
              console.warn("⚠️ 埋点发送失败:", response.status, response.statusText);
            }
          })
          .catch((error) => {
            console.error("❌ 埋点发送错误:", error);
          });
      },
    };

    return Analytics;
  }

  // ========== 数据获取功能 ==========
  function getOSName(){
    const userAgentName = navigator.userAgent;
    if(/Windows/i.test(userAgentName)) return "Windows";
      if (/Mac/i.test(userAgentName)) return "Mac";
      if (/Linux/i.test(userAgentName)) return "Linux";
      return "Unknown";
  }
  function initDataFetchers() {
    async function getTraceId(downloadUrl, getOSName) {
      return new Promise((resolve, reject) => {
        const pid = Analytics.extractPidFromUrl(downloadUrl);
        if (!pid) {
          reject("PID is empty");
          return;
        }

        $.ajax({
          url: "https://prod-web.wondershare.cc/api/v1/prodweb/trk",
          method: "GET",
          data: { pid, download_url: downloadUrl, getOSName },
          dataType: "json",
          timeout: 5000,
          success: (response) => {
            if (response?.trace_id) {
              resolve(response.trace_id);
            } else {
              reject("响应中没有找到trace_id");
            }
          },
          error: (xhr, textStatus, errorThrown) => {
            reject(`请求失败: ${textStatus} - ${errorThrown}`);
          },
        });
      });
    }

    async function getUserIpInfo() {
      return new Promise((resolve, reject) => {
        $.ajax({
          url: "https://api-web.wondershare.cc/v3/baseapi/web/country-by-ip",
          method: "GET",
          dataType: "json",
          timeout: 5000,
          success: resolve,
          error: (xhr, textStatus, errorThrown) => {
            reject(`获取IP信息失败: ${textStatus} - ${errorThrown}`);
          },
        });
      });
    }

    return { getTraceId, getUserIpInfo };
  }

  // ========== 初始化埋点系统 ==========
  const Analytics = initAnalytics();
  const DataFetchers = initDataFetchers();
  
  // 标记页面是否已完成初始化下载
  let isInitialDownloadCompleted = false;
  // 标记页面离开埋点是否已发送,避免重复发送
  let isPageLeaveSent = false;
  
  // ========== 页面离开埋点 ==========
  function initPageLeaveTracking() {
    // 发送页面离开埋点的核心函数
    function sendPageLeaveEvent() {
      // 防止重复发送
      if (isPageLeaveSent) {
        return;
      }
      
      // 只有在初始化下载完成后才发送页面离开埋点
      if (!isInitialDownloadCompleted) {
        return;
      }
      
      // 标记已发送
      isPageLeaveSent = true;
      
      // 计算停留时长
      const stayDuration = Date.now() - PAGE_LOAD_TIME;
      
      // 发送埋点
      Analytics.track("download_page_leave", {
        duration: Math.round(stayDuration / 1000),
      });
    }
    
    // 监听多种页面离开事件,确保覆盖所有场景
    
    // 1. beforeunload - 页面即将卸载时触发(刷新、关闭、跳转等)
    window.addEventListener("beforeunload", function (e) {
      sendPageLeaveEvent();
    });
    
    // 2. unload - 页面卸载时触发(作为 beforeunload 的备用)
    window.addEventListener("unload", function (e) {
      sendPageLeaveEvent();
    });
    
    // 3. pagehide - 页面被隐藏时触发(适用于移动端和 bfcache)
    window.addEventListener("pagehide", function (e) {
      sendPageLeaveEvent();
    });
    
    // 4. visibilitychange - 页面可见性改变时(切换标签页、最小化等)
    document.addEventListener("visibilitychange", function () {
      // 只在页面完全隐藏且用户真正离开时发送
      if (document.visibilityState === "hidden") {
        sendPageLeaveEvent();
      }
    });
  }

  // ========== 页面初始化并发送页面访问埋点 ==========
  async function initializePageAnalytics() {
    Analytics.initCommonParams();

    const currentDownloadUrl = downloadUrl;
    const osType = platform === 'mac' ? 'Mac' : 'Windows';

    const [traceResult, ipResult] = await Promise.allSettled([
      DataFetchers.getTraceId(currentDownloadUrl, osType), 
      DataFetchers.getUserIpInfo()
    ]);

    if (traceResult.status === "fulfilled") {
      Analytics.updateConfig("trace_id", traceResult.value);
    }

    if (ipResult.status === "fulfilled" && ipResult.value?.data?.ip) {
      Analytics.updateConfig("ip", ipResult.value.data.ip);
    }

    Analytics.track("download_page_view", {
      pop_name: "download_progress",
    });
  }

  
  // 初始化页面访问埋点
  initializePageAnalytics();
    // 初始化页面离开埋点
  initPageLeaveTracking();
  // ========== 原有的教程视频功能（添加埋点） ==========
  const $tutorialModal = $("#tutorial-video-modal");
  const $videoIframe = $("#tutorial-video-iframe");
  let videoLoaded = false;

  // 添加教程视频按钮点击埋点
  $('[data-target="#tutorial-video-modal"]').on("click", function () {
    Analytics.track("download_page_click", {
      button: "watch_tutorial_video",
    });
  });

  // 弹窗显示时加载并播放视频
  $tutorialModal.on("shown.bs.modal", function () {
    // 首次打开时才加载iframe
    if (!videoLoaded) {
     // 根据系统选择对应的视频链接
      const dataSrc = platform === 'mac' 
        ? $videoIframe.attr("data-mac-src") 
        : $videoIframe.attr("data-win-src");
      if (dataSrc) {
        $videoIframe.attr("src", dataSrc);
        videoLoaded = true;

        // 等待iframe加载完成后再发送播放命令
        $videoIframe.on("load", function () {
          setTimeout(() => {
            const iframe = this;
            if (iframe && iframe.contentWindow) {
              iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', "*");
            }
          }, 100); // 给YouTube API一点时间初始化
        });
      }
    } else {
      // 已加载的情况下直接播放
      const iframe = $videoIframe[0];
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', "*");
      }
    }
  });

  // 弹窗关闭时暂停视频
  $tutorialModal.on("hidden.bs.modal", function () {
    if (videoLoaded) {
      const iframe = $videoIframe[0];
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', "*");
      }
    }
  });
  // 浏览器快捷键配置(区分Mac和Windows/其他系统)
  function getBrowserShortcut() {
    const userAgent = navigator.userAgent.toLowerCase();
    const isMac = /mac/i.test(navigator.userAgent);
    
    if (isMac) {
      // Mac系统快捷键
      if (userAgent.includes("safari") && !userAgent.includes("chrome")) {
        return "Command + Option + L";
      } else if (userAgent.includes("chrome") && !userAgent.includes("edg")) {
        return "Command + Option + L";
      } else if (userAgent.includes("firefox")) {
        return "Command + J";
      } else if (userAgent.includes("opr") || userAgent.includes("opera")) {
        return "Command + Shift + D";
      }
      return "Command + Option + L";
    } else {
      // Windows及其他系统快捷键
      if (userAgent.includes("edg")) {
        return "Ctrl + J";
      } else if (userAgent.includes("chrome")) {
        return "Ctrl + J";
      } else if (userAgent.includes("firefox")) {
        return "Ctrl + J";
      } else if (userAgent.includes("opr") || userAgent.includes("opera")) {
        return "Ctrl + Shift + D";
      }
      return "Ctrl + J";
    }
  }

  // 设置快捷键文案
  $("#browser-shortcut").text(getBrowserShortcut());

  // 视频懒加载控制
  function loadAndPlayVideos() {
    $(".step-video video").each(function () {
      const $video = $(this);
      if ($video.data("src") && !$video.attr("src")) {
        $video.attr("src", $video.data("src"));
        this.load();
      }
      // 无论是否新加载，都尝试播放
      this.play();
    });
  }

  function pauseAllVideos() {
    $(".step-video video").each(function () {
      this.pause();
    });
  }

  // 显示下载指引弹窗
  function showDownloadGuidance() {
    $("#download-guidance-overlay").removeClass("hidden");
    pauseAllVideos();
  }

  // 弹窗控制 - 只绑定一次
  $("#download-guidance-overlay").on("click", function (e) {
    if (e.target === this) {
      $(this).addClass("hidden");
      loadAndPlayVideos();
    }
  });
  
  // Restart download按钮点击事件（添加埋点）
  let isFirstClick = true;
  
  $(".resDownBtn").on("click", function (e) {
    // 添加下载按钮点击埋点
    Analytics.track("download_page_click", {
      button: isFirstClick ? "download" : "restart_download",
    });

    if (isFirstClick) {
      isFirstClick = false;
    }

    showDownloadGuidance();
  });
  $(".btn-link").on("click", function (e) {
    showDownloadGuidance();
  });
  
  // 页面加载完成后立即触发下载(仅Mac系统)
  if (platform === 'mac') {
    // 检测是否为Safari浏览器
    const userAgent = navigator.userAgent.toLowerCase();
    const isSafari = userAgent.includes("safari") && !userAgent.includes("chrome") && !userAgent.includes("edg");
    
    // 先触发点击事件
    $(".btn-link")[0].click();
    
    // Safari浏览器在触发下载后重新加载渲染所有图片
    if (isSafari) {
      setTimeout(() => {
        console.log('Safari: 开始重新渲染图片');
        
        // 强制重新渲染页面上的所有img标签
        $('img[src]').each(function() {
          const $img = $(this);
          const originalSrc = $img.attr('src');
          
          if (originalSrc) {
            // 临时清空src触发重新加载
            $img.css('opacity', '0');
            const tempSrc = $img.attr('src');
            $img.attr('src', '');
            
            // 使用requestAnimationFrame在下一帧重新设置
            requestAnimationFrame(() => {
              $img.attr('src', tempSrc);
              // 添加淡入过渡效果
              $img.css({
                'opacity': '1',
                'transition': 'opacity 0.3s ease'
              });
            });
          }
        });
        
        // 强制重新渲染video标签的poster封面图
        $('video[poster]').each(function() {
          const $video = $(this);
          const originalPoster = $video.attr('poster');
          
          if (originalPoster) {
            // 临时清空poster触发重新加载
            const tempPoster = $video.attr('poster');
            $video.attr('poster', '');
            
            // 使用requestAnimationFrame在下一帧重新设置
            requestAnimationFrame(() => {
              $video.attr('poster', tempPoster);
            });
          }
        });
        
        console.log('Safari: 图片和视频封面重新渲染完成');
      }, 300); // 延迟300ms,确保弹窗已显示
    }
  } else {
    showDownloadGuidance();
  }
  
  // 延迟标记初始化下载完成,避免触发页面离开埋点
  setTimeout(() => {
    isInitialDownloadCompleted = true;
  }, 1000);
});

</script>
<script>
  (function() {
     var userInfo = getCookie('user_identity') 
      function getCookie(name) {
            var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
            return v ? decodeURIComponent(v[2]) : null;
        }
      if(userInfo){
          $('.new-model-box')[0].remove()
        }
      if(!userInfo) {
        var sourceVal = '',dataHref = 'https://accounts.wondershare.com',langVal = '',hrefVal = ''
        if(document.querySelector('.login-link')){
          sourceVal = document.querySelector('.login-link').getAttribute('data-source') || ''
          dataHref = document.querySelector('.login-link').getAttribute('data-href').replace(/\/$/, "")
          langVal = document.querySelector('.login-link').getAttribute('data-lang') || ''
        }
        var extraVal = btoa(JSON.stringify({"from_scene":"seo_downloadguidance_signup"}))
        hrefVal  = dataHref + '/web/register-new?lang='+ langVal+'&redirect_uri='+encodeURIComponent(window.location.href)+'&source='+sourceVal+'&site='+location.hostname+'&verify=no&extra='+extraVal
        $('.sign-up-btn').attr('href',hrefVal)
      }
    }())
</script>

<script src="https://neveragain.allstatics.com/2019/assets/nps/nps.js" defer ></script>

<script src="https://www.wondershare.com/ga360/js/ga360-add.js"></script>
<!-- Google Tag Manager (noscript) Body -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57FR6ZG" height="0" width="0" 
  style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) Body -->
</body>
</html>